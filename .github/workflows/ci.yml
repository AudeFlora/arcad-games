name: CI - IntÃ©gration Continue

on:
  push:
    branches: [dev, main]
  pull_request:
    branches: [main]

jobs:
  test-and-build:
    name: Tests et Build
    runs-on: ubuntu-latest
    
    steps:
    # 1. RÃ©cupÃ©ration du code
    - name: ğŸ“¥ Checkout du code
      uses: actions/checkout@v4
      
    # 2. Installation des dÃ©pendances (simulÃ© pour projet HTML)
    - name: ğŸ“¦ Installer les dÃ©pendances
      run: |
        echo "=== INSTALLATION DES DÃ‰PENDANCES ==="
        echo "Projet HTML statique - pas de dÃ©pendances Ã  installer"
        echo "âœ… Installation terminÃ©e"
        
    # 3. ExÃ©cution des tests unitaires
    - name: ğŸ§ª Lancer les tests unitaires
      run: |
        echo "=== EXÃ‰CUTION DES TESTS ==="
        
        # VÃ©rifier que les fichiers essentiels existent
        echo "1. VÃ©rification des fichiers..."
        if [ ! -f "src/index.html" ]; then
          echo "âŒ ERREUR: src/index.html manquant"
          exit 1
        fi
        echo "âœ… src/index.html prÃ©sent"
        
        # ExÃ©cuter les tests JavaScript si le fichier existe
        if [ -f "tests/test.js" ]; then
          echo "2. ExÃ©cution des tests JavaScript..."
          node tests/test.js
          echo "âœ… Tests JavaScript passÃ©s"
        else
          echo "âš ï¸  Aucun test JavaScript trouvÃ©"
          echo "âœ… VÃ©rification de base terminÃ©e"
        fi
        
    # 4. GÃ©nÃ©ration de l'artefact (build)
    - name: ğŸ—ï¸ GÃ©nÃ©rer l'artefact de build
      run: |
        echo "=== GÃ‰NÃ‰RATION DU BUILD ==="
        
        # CrÃ©er le dossier de build
        mkdir -p build
        
        # Copier tous les fichiers de src/
        echo "ğŸ“ Copie des fichiers sources..."
        cp -r src/* build/ 2>/dev/null || true
        
        # VÃ©rifier que le build contient index.html
        if [ ! -f "build/index.html" ]; then
          echo "âŒ ERREUR: build/index.html non gÃ©nÃ©rÃ©"
          exit 1
        fi
        
        echo "ğŸ“Š Contenu du build:"
        ls -la build/
        echo "âœ… Build gÃ©nÃ©rÃ© avec succÃ¨s"
        
    # 5. Upload de l'artefact
    - name: â¬†ï¸ Uploader l'artefact
      uses: actions/upload-artifact@v4
      with:
        name: web-app-build
        path: build/
        retention-days: 7
        
    # 6. Logs de build (rÃ©sumÃ©)
    - name: ğŸ“‹ Afficher les logs de build
      if: always()
      run: |
        echo "========================================"
        echo "ğŸ“Š LOGS DE BUILD - RÃ‰SUMÃ‰"
        echo "========================================"
        echo "ğŸŒ¿ Branche: ${{ github.ref_name }}"
        echo "ğŸ”— Commit: ${{ github.sha }}"
        echo "ğŸ“… Date: $(date)"
        echo "âœ… Tests: PASSÃ‰S"
        echo "ğŸ—ï¸ Build: GÃ‰NÃ‰RÃ‰ (dossier build/)"
        echo "ğŸ“¦ Artefact: web-app-build"
        echo "========================================"